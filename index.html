<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <title>AR - Caballo 3D</title>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #000;
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
    }

    /* Precargador */
    .preloader {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,255,255,0.3);
      border-top-color: #4CAF50;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .preloader-text { margin-top: 15px; font-size: 1.2rem; }

    /* Panel inicial */
    .instruction-panel {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      z-index: 20;
      max-width: 90%;
      width: 350px;
    }
    .instruction-panel h2 { margin-bottom: 10px; color: #4CAF50; }
    #start-ar-btn {
      margin-top: 15px;
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 1.1rem;
      border-radius: 30px;
      cursor: pointer;
    }
    #start-ar-btn:hover { background: #45a049; }

    /* Gu√≠a */
    #alignment-guide {
      position: fixed;
      top: 50%;
      left: 0;
      width: 100%;
      height: 120px;
      background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
      display: none;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      padding-bottom: 20px;
      z-index: 10;
    }
    .guide-line {
      width: 80%;
      height: 4px;
      background: #4CAF50;
      margin-bottom: 10px;
      border-radius: 2px;
      box-shadow: 0 0 10px rgba(76,175,80,0.7);
    }

    /* Bot√≥n mostrar caballo */
    #show-horse-btn {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: #4CAF50;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 1.2rem;
      border-radius: 30px;
      cursor: pointer;
      z-index: 20;
      display: none;
    }
    #show-horse-btn:hover { background: #45a049; }

    /* Mensaje √©xito */
    .success-message {
      position: fixed;
      top: 30px; left: 50%;
      transform: translateX(-50%);
      background: rgba(0,150,0,0.9);
      padding: 12px 25px;
      border-radius: 10px;
      animation: fadeInOut 3s ease-in-out;
      z-index: 30;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, -20px); }
      20% { opacity: 1; transform: translate(-50%, 0); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -20px); }
    }

    #scene-container { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <!-- Precargador -->
  <div class="preloader">
    <div class="spinner"></div>
    <div class="preloader-text">Cargando experiencia AR...</div>
  </div>

  <!-- Panel inicial -->
  <div class="instruction-panel" id="initial-instruction" style="display:none;">
    <h2>üêé Caballo AR</h2>
    <p>Vive la experiencia de tener un caballo animado en tu espacio mediante realidad aumentada.</p>
    <button id="start-ar-btn">Comenzar Experiencia</button>
  </div>

  <!-- Gu√≠a -->
  <div id="alignment-guide">
    <div class="guide-line"></div>
    <div class="guide-text">Alinea el celular con el piso</div>
  </div>

  <!-- Bot√≥n mostrar -->
  <button id="show-horse-btn">Mostrar Caballo</button>

  <!-- Contenedor de la escena -->
  <div id="scene-container"></div>

  <script>
    window.addEventListener("load", () => {
      // Simula carga inicial
      setTimeout(() => {
        document.querySelector(".preloader").style.display = "none";
        document.getElementById("initial-instruction").style.display = "block";
      }, 1500);

      const startBtn = document.getElementById("start-ar-btn");
      const sceneContainer = document.getElementById("scene-container");
      const alignmentGuide = document.getElementById("alignment-guide");
      const showHorseBtn = document.getElementById("show-horse-btn");

      let horseVisible = false;

      // Iniciar AR solo al pulsar
      startBtn.addEventListener("click", () => {
        document.getElementById("initial-instruction").style.display = "none";

        // Crear la escena din√°micamente
        sceneContainer.innerHTML = `
          <a-scene
            embedded
            vr-mode-ui="enabled: false"
            arjs="sourceType: webcam; facingMode: environment; debugUIEnabled: false;"
            loading-screen="enabled: false">
            
            <a-assets>
              <a-asset-item id="horse-model" src="horseRA2.glb"></a-asset-item>
            </a-assets>
            
            <a-entity id="horse-entity"
              gltf-model="#horse-model"
              position="0 -1.5 -3"
              rotation="0 90 0"
              scale="1 1 1"
              visible="false"
              animation-mixer="loop: repeat">
            </a-entity>
            
            <a-camera></a-camera>
          </a-scene>
        `;

        // Mostrar gu√≠a y bot√≥n
        alignmentGuide.style.display = "flex";
        showHorseBtn.style.display = "block";
      });

      // Mostrar caballo
      showHorseBtn.addEventListener("click", () => {
        if (!horseVisible) {
          const horse = document.getElementById("horse-entity");
          if (horse) {
            horse.setAttribute("visible", "true");
            horseVisible = true;
            alignmentGuide.style.display = "none";
            showHorseBtn.style.display = "none";

            // Mensaje de √©xito
            const msg = document.createElement("div");
            msg.className = "success-message";
            msg.textContent = "‚úÖ Caballo posicionado en tu espacio";
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
          }
        }
      });
    });
  </script>
</body>
</html>
